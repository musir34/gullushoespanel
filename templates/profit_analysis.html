<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <title>Kâr-Zarar Analizi</title>
    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <style>
      body {
        background-color: #f8f9fa;
      }
      .analysis-container {
        max-width: 1000px;
        margin: 40px auto;
      }
      .table th, .table td {
        vertical-align: middle;
      }
      .skipped-count {
        color: #dc3545; /* Kırmızı ton */
        font-weight: 600;
      }
    </style>
  </head>

  <body>
    <div class="container analysis-container">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0">Kâr-Zarar Analizi</h4>
        </div>
        <div class="card-body">
          <!-- Flask flash mesajlarını burada gösterebilirsiniz -->
          {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
              <div class="alert alert-info">
                <ul>
                  {% for category, message in messages %}
                  <li><strong>{{ category }}:</strong> {{ message }}</li>
                  {% endfor %}
                </ul>
              </div>
            {% endif %}
          {% endwith %}

          <p class="text-secondary">
            Komisyonu 0 veya negatif olan <span class="skipped-count">{{ skipped_count }}</span> sipariş atlandı.
          </p>

          {% if results|length == 0 %}
            <div class="alert alert-warning">
              Kâr-zarar hesabına katılabilecek sipariş bulunamadı veya tamamı atlandı!
            </div>
          {% else %}
            <div class="table-responsive">
              <table class="table table-striped align-middle">
                <thead class="table-dark">
                  <tr>
                    <th scope="col">Sipariş No</th>
                    <th scope="col">Satış (TL)</th>
                    <th scope="col">İndirim</th>
                    <th scope="col">Komisyon</th>
                    <th scope="col">Maliyet</th>
                    <th scope="col">Adet</th>
                    <th scope="col" class="text-end">Kâr</th>
                  </tr>
                </thead>
                <tbody>
                  {% for r in results %}
                  <tr>
                    <td>{{ r.order_number }}</td>
                    <td>{{ r.amount }}</td>
                    <td>{{ r.discount }}</td>
                    <td>{{ r.commission }}</td>
                    <td>{{ r.cost_try }}</td>
                    <td>{{ r.quantity }}</td>
                    <td class="text-end">{{ r.net_profit }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% endif %}
        </div> <!-- end of card-body -->
      </div> <!-- end of card -->
    </div> <!-- end of container -->

    <!-- Bootstrap 5 JS -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
    ></script>
  </body>
</html>
