<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <title>Excel Komisyon Güncelle</title>
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
      body {
        background-color: #f8f9fa;
      }
      .upload-container {
        max-width: 800px;
        margin: 50px auto;
      }
      .card {
        border-radius: 8px;
      }
      .card-header {
        background-color: #343a40;
        color: #fff;
        border-radius: 8px 8px 0 0;
      }
      .btn-custom-upload {
        background-color: #28a745;
        border-color: #28a745;
      }
      .btn-custom-upload:hover {
        background-color: #218838;
        border-color: #1e7e34;
      }
      .file-list {
        margin-top: 20px;
      }
      .table-striped>tbody>tr:nth-of-type(odd) {
        background-color: rgba(0, 0, 0, 0.05);
      }
    </style>
  </head>

  <body>
    <div class="container upload-container">
      <div class="card shadow">
        <div class="card-header">
          <h4 class="mb-0">Excel Dosyası Yükleme (Komisyon Güncelle)</h4>
        </div>
        <div class="card-body">
          <!-- Flask flash mesajları -->
          {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
              <div class="alert alert-info">
                <ul class="mb-0">
                  {% for category, message in messages %}
                  <li><strong>{{ category }}:</strong> {{ message }}</li>
                  {% endfor %}
                </ul>
              </div>
            {% endif %}
          {% endwith %}

          <p class="text-secondary">
            Buradan tek veya birden fazla Excel dosyası <strong>(.xlsx, .xls)</strong> yükleyebilirsiniz.
            <br>Dosyalar seçildikten sonra <em>Yükle ve Gönder</em> butonuna basarak işleme başlayabilirsiniz.
          </p>

          <!-- Çoklu dosya yükleme formu -->
          <form 
            action="{{ url_for('commission_update_bp.update_commission_from_excel') }}" 
            method="POST" 
            enctype="multipart/form-data"
            class="row g-3"
          >
            <div class="col-12">
              <label for="excelFiles" class="form-label fw-bold">Excel Dosyaları:</label>
              <input 
                class="form-control" 
                type="file" 
                id="excelFiles" 
                name="excel_files" 
                accept=".xlsx, .xls" 
                multiple 
                required 
              />
            </div>

            <div class="col-12 mt-3">
              <button type="submit" class="btn btn-custom-upload text-white">
                Yükle ve Gönder
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Yüklenen Excel dosyalarını listele -->
      <div class="file-list mt-4">
        <h5>Yüklenen Excel Dosyaları</h5>
        <div class="d-flex mb-2">
          <!-- Ada göre sırala -->
          <a href="{{ url_for('commission_update_bp.update_commission_from_excel', sort='name', all=('1' if show_all else '0')) }}"
             class="btn btn-sm btn-outline-primary me-2">
            Ada Göre Sırala
          </a>
          <!-- Tarihe göre sırala -->
          <a href="{{ url_for('commission_update_bp.update_commission_from_excel', sort='date', all=('1' if show_all else '0')) }}"
             class="btn btn-sm btn-outline-primary me-2">
            Tarihe Göre Sırala
          </a>
          <!-- Tümü / 10 tane göster toggle -->
          {% if not show_all %}
            <a href="{{ url_for('commission_update_bp.update_commission_from_excel', sort=sort_by, all='1') }}"
               class="btn btn-sm btn-outline-secondary">
              Tümünü Listele
            </a>
          {% else %}
            <a href="{{ url_for('commission_update_bp.update_commission_from_excel', sort=sort_by, all='0') }}"
               class="btn btn-sm btn-outline-secondary">
              Sadece 10 Tane Göster
            </a>
          {% endif %}
        </div>

        {% if uploads %}
        <table class="table table-bordered table-striped">
          <thead class="table-light">
            <tr>
              <th>Dosya Adı</th>
              <th>Yükleme Tarihi</th>
              <th>İndir</th>
            </tr>
          </thead>
          <tbody>
            {% for item in uploads %}
            <tr>
              <td>{{ item.filename }}</td>
              <td>{{ item.upload_time.strftime('%Y-%m-%d %H:%M:%S') }}</td>
              <td>
                <a 
                  href="{{ url_for('commission_update_bp.download_excel', filename=item.filename) }}" 
                  class="btn btn-sm btn-primary"
                >
                  İndir
                </a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
          <p class="text-muted">Hiç yüklenmiş Excel dosyası yok.</p>
        {% endif %}
      </div>
    </div>

    <!-- Bootstrap 5 JS (opsiyonel) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
