<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Profit Dashboard - Glassmorphism</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/glass.css') }}">
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
<div class="container">
  <!-- Navbar benzeri -->
  <nav class="navbar">
    <div class="navbar-title">Glass Profit</div>
    <div class="navbar-links">
      <a href="#">Anasayfa</a>
      <a href="#">Raporlar</a>
      <a href="#">İstatistik</a>
    </div>
  </nav>

  <h2 style="margin-bottom:20px;">Kâr-Zarar Raporu (Cam Tasarım)</h2>

  <!-- Form -->
  <form method="POST" class="analysis-form">
    <div class="form-group">
      <label for="start_date">Başlangıç Tarihi</label>
      <input type="date" id="start_date" name="start_date">
    </div>
    <div class="form-group">
      <label for="end_date">Bitiş Tarihi</label>
      <input type="date" id="end_date" name="end_date">
    </div>
    <div class="form-group">
      <label for="package_cost">Paket Maliyeti (₺)</label>
      <input type="number" step="0.01" id="package_cost" name="package_cost">
    </div>
    <div class="form-group">
      <label for="employee_cost">İşçilik Maliyeti (₺)</label>
      <input type="number" step="0.01" id="employee_cost" name="employee_cost">
    </div>
    <div class="form-group">
      <label for="shipping_cost">Kargo Maliyeti (₺)</label>
      <input type="number" step="0.01" id="shipping_cost" name="shipping_cost">
    </div>
    <button type="submit" class="btn btn-primary">Analizi Başlat</button>
  </form>

  {% if analysis %}
    <!-- Stat Cards -->
    <div class="stat-cards">
      <div class="stat-card">
        <div class="stat-title">Toplam Gelir</div>
        <div class="stat-value">{{ "%.2f"|format(total_revenue or 0) }} ₺</div>
      </div>
      <div class="stat-card">
        <div class="stat-title">Komisyon Gideri</div>
        <div class="stat-value">{{ "%.2f"|format(total_commission_spent or 0) }} ₺</div>
      </div>
      <div class="stat-card">
        <div class="stat-title">Paket Gideri</div>
        <div class="stat-value">{{ "%.2f"|format(total_package_spent or 0) }} ₺</div>
      </div>
      <div class="stat-card">
        <div class="stat-title">Kargo Gideri</div>
        <div class="stat-value">{{ "%.2f"|format(total_shipping_spent or 0) }} ₺</div>
      </div>
      <div class="stat-card">
        <div class="stat-title">İşçilik Gideri</div>
        <div class="stat-value">{{ "%.2f"|format(total_employee_spent or 0) }} ₺</div>
      </div>
    </div>

    <!-- Summary Panel -->
    <div class="summary-panel">
      <div class="summary-item">
        <div class="summary-label">Toplam Kâr</div>
        <div class="summary-value">{{ "%.2f"|format(total_profit or 0) }} ₺</div>
      </div>
      <div class="summary-item">
        <div class="summary-label">Ortalama Kâr</div>
        <div class="summary-value">{{ "%.2f"|format(avg_profit or 0) }} ₺</div>
      </div>
    </div>

    <!-- Analysis Table -->
    <table class="analysis-table">
      <thead>
        <tr>
          <th>Sipariş No</th>
          <th>Ürün</th>
          <th>Gelir (₺)</th>
          <th>Gider (₺)</th>
          <th>Kâr (₺)</th>
        </tr>
      </thead>
      <tbody>
      {% for item in analysis %}
        <tr class="{{ 'profit' if item.profit >= 0 else 'loss' }}">
          <td>{{ item.order_number }}</td>
          <td>{{ item.product }}</td>
          <td>{{ "%.2f"|format(item.net_income) }}</td>
          <td>{{ "%.2f"|format(item.total_expenses) }}</td>
          <td>{{ "%.2f"|format(item.profit) }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  {% else %}
    <div class="glass-card">
      <div class="card-header">Analiz Sonucu Yok</div>
      <div class="card-body">Henüz bir filtre girilmedi veya sonuç bulunamadı.</div>
    </div>
  {% endif %}
</div>

</body>
</html>
